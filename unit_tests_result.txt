Run pytest tests/unit/ \
============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-7.4.4, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
cachedir: .pytest_cache
metadata: {'Python': '3.11.13', 'Platform': 'Linux-6.11.0-1018-azure-x86_64-with-glibc2.39', 'Packages': {'pytest': '7.4.4', 'pluggy': '1.6.0'}, 'Plugins': {'xdist': '3.8.0', 'cov': '4.1.0', 'timeout': '2.4.0', 'mock': '3.14.1', 'metadata': '3.1.1', 'anyio': '4.10.0', 'html': '4.1.1', 'asyncio': '0.23.8'}, 'CI': 'true', 'JAVA_HOME': '/usr/lib/jvm/temurin-17-jdk-amd64'}
rootdir: /home/runner/work/ha-ml-predictor/ha-ml-predictor
configfile: pytest.ini
plugins: xdist-3.8.0, cov-4.1.0, timeout-2.4.0, mock-3.14.1, metadata-3.1.1, anyio-4.10.0, html-4.1.1, asyncio-0.23.8
timeout: 30.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
created: 2/2 workers
2 workers [753 items]

scheduling tests via LoadScheduling

tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_all_retraining_status_retrieval 
tests/unit/test_environment_management.py::TestEnvironment::test_environment_from_string 
[gw0] [  0%] PASSED tests/unit/test_environment_management.py::TestEnvironment::test_environment_from_string 
tests/unit/test_environment_management.py::TestSecretsManager::test_encryption_decryption 
[gw0] [  0%] PASSED tests/unit/test_environment_management.py::TestSecretsManager::test_encryption_decryption 
tests/unit/test_environment_management.py::TestSecretsManager::test_store_and_retrieve_secret 
[gw0] [  0%] PASSED tests/unit/test_environment_management.py::TestSecretsManager::test_store_and_retrieve_secret 
tests/unit/test_environment_management.py::TestSecretsManager::test_list_secrets 
[gw0] [  0%] PASSED tests/unit/test_environment_management.py::TestSecretsManager::test_list_secrets 
tests/unit/test_environment_management.py::TestSecretsManager::test_nonexistent_secret 
[gw0] [  0%] PASSED tests/unit/test_environment_management.py::TestSecretsManager::test_nonexistent_secret 
tests/unit/test_environment_management.py::TestEnvironmentManager::test_environment_detection_default 
[gw0] [  0%] PASSED tests/unit/test_environment_management.py::TestEnvironmentManager::test_environment_detection_default 
tests/unit/test_environment_management.py::TestEnvironmentManager::test_environment_detection_env_var 
[gw0] [  0%] PASSED tests/unit/test_environment_management.py::TestEnvironmentManager::test_environment_detection_env_var 
tests/unit/test_environment_management.py::TestEnvironmentManager::test_get_environment_settings 
[gw0] [  1%] PASSED tests/unit/test_environment_management.py::TestEnvironmentManager::test_get_environment_settings 
tests/unit/test_environment_management.py::TestEnvironmentManager::test_load_environment_config 
[gw0] [  1%] PASSED tests/unit/test_environment_management.py::TestEnvironmentManager::test_load_environment_config 
tests/unit/test_environment_management.py::TestEnvironmentManager::test_secret_management 
[gw0] [  1%] PASSED tests/unit/test_environment_management.py::TestEnvironmentManager::test_secret_management 
tests/unit/test_environment_management.py::TestEnvironmentManager::test_configuration_validation 
[gw1] [  1%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_all_retraining_status_retrieval 
tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_retrainer_statistics 
[gw1] [  1%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_retrainer_statistics 
tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_performance_metrics_tracking 
[gw1] [  1%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_performance_metrics_tracking 
tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_retraining_processor_loop 
[gw1] [  1%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_retraining_processor_loop 
tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_trigger_checker_loop 
[gw1] [  1%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_trigger_checker_loop 
tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_background_task_error_handling 
[gw0] [  2%] FAILED tests/unit/test_environment_management.py::TestEnvironmentManager::test_configuration_validation 
tests/unit/test_environment_management.py::TestConfigurationValidator::test_validation_result 
[gw0] [  2%] PASSED tests/unit/test_environment_management.py::TestConfigurationValidator::test_validation_result 
tests/unit/test_environment_management.py::TestConfigurationValidator::test_merge_validation_results 
[gw0] [  2%] PASSED tests/unit/test_environment_management.py::TestConfigurationValidator::test_merge_validation_results 
tests/unit/test_environment_management.py::TestConfigurationValidator::test_home_assistant_validation 
[gw0] [  2%] PASSED tests/unit/test_environment_management.py::TestConfigurationValidator::test_home_assistant_validation 
tests/unit/test_environment_management.py::TestConfigurationValidator::test_database_validation 
[gw1] [  2%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_background_task_error_handling 
[gw0] [  2%] PASSED tests/unit/test_environment_management.py::TestConfigurationValidator::test_database_validation 
tests/unit/test_adaptation/test_retrainer.py::TestNotificationIntegration::test_retraining_completion_notifications 
tests/unit/test_environment_management.py::TestBackupManager::test_backup_manager_initialization 
[gw0] [  2%] PASSED tests/unit/test_environment_management.py::TestBackupManager::test_backup_manager_initialization 
tests/unit/test_environment_management.py::TestBackupManager::test_database_backup_creation 
[gw0] [  3%] PASSED tests/unit/test_environment_management.py::TestBackupManager::test_database_backup_creation 
tests/unit/test_environment_management.py::TestBackupManager::test_list_backups 
[gw0] [  3%] PASSED tests/unit/test_environment_management.py::TestBackupManager::test_list_backups 
tests/unit/test_environment_management.py::TestEnvironmentIntegration::test_full_environment_workflow 
[gw1] [  3%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestNotificationIntegration::test_retraining_completion_notifications 
[gw0] [  3%] PASSED tests/unit/test_environment_management.py::TestEnvironmentIntegration::test_full_environment_workflow 
tests/unit/test_adaptation/test_retrainer.py::TestNotificationIntegration::test_retraining_failure_notifications 
tests/unit/test_environment_management.py::TestEnvironmentIntegration::test_environment_variable_precedence 
[gw0] [  3%] PASSED tests/unit/test_environment_management.py::TestEnvironmentIntegration::test_environment_variable_precedence 
tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_detector_initialization 
[gw0] [  3%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_detector_initialization 
tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_drift_detection_with_no_drift 
[gw0] [  3%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_drift_detection_with_no_drift 
tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_drift_detection_with_accuracy_degradation 
[gw1] [  3%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestNotificationIntegration::test_retraining_failure_notifications 
tests/unit/test_adaptation/test_retrainer.py::TestErrorHandlingAndRecovery::test_model_training_failure_handling 
[gw0] [  4%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_drift_detection_with_accuracy_degradation 
tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_page_hinkley_drift_detection 
[gw0] [  4%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_page_hinkley_drift_detection 
tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_statistical_confidence_calculation 
[gw0] [  4%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_statistical_confidence_calculation 
tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_drift_metrics_serialization 
[gw0] [  4%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_drift_metrics_serialization 
tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_error_handling_in_drift_detection 
[gw0] [  4%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestConceptDriftDetector::test_error_handling_in_drift_detection 
tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_feature_detector_initialization 
[gw1] [  4%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestErrorHandlingAndRecovery::test_model_training_failure_handling 
tests/unit/test_adaptation/test_retrainer.py::TestErrorHandlingAndRecovery::test_missing_model_handling 
[gw0] [  4%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_feature_detector_initialization 
tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_numerical_feature_drift_detection 
[gw1] [  5%] ERROR tests/unit/test_adaptation/test_retrainer.py::TestErrorHandlingAndRecovery::test_missing_model_handling 
[gw0] [  5%] FAILED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_numerical_feature_drift_detection 
tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_categorical_feature_drift_detection 
[gw0] [  5%] FAILED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_categorical_feature_drift_detection 
tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_feature_drift_with_insufficient_data 
[gw0] [  5%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_feature_drift_with_insufficient_data 
tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_feature_drift_monitoring_lifecycle 
[gw0] [  5%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_feature_drift_monitoring_lifecycle 
tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_drift_callback_functionality 
[gw0] [  5%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_drift_callback_functionality 
tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_combined_drift_detection_workflow 
[gw0] [  5%] FAILED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_combined_drift_detection_workflow 
tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_drift_severity_classification 
[gw0] [  5%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_drift_severity_classification 
tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_drift_recommendation_generation 
[gw0] [  6%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_drift_recommendation_generation 
tests/unit/test_adaptation/test_drift_detector.py::TestStatisticalTests::test_kolmogorov_smirnov_test 
[gw0] [  6%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestStatisticalTests::test_kolmogorov_smirnov_test 
tests/unit/test_adaptation/test_drift_detector.py::TestStatisticalTests::test_chi_square_test 
[gw0] [  6%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestStatisticalTests::test_chi_square_test 
tests/unit/test_adaptation/test_drift_detector.py::TestStatisticalTests::test_population_stability_index 
[gw0] [  6%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestStatisticalTests::test_population_stability_index 
tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_empty_data_handling 
[gw0] [  6%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_empty_data_handling 
tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_extreme_drift_scenarios 
[gw0] [  6%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_extreme_drift_scenarios 
tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_concurrent_drift_detection 
[gw0] [  6%] PASSED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_concurrent_drift_detection 
tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_feature_drift_with_mixed_data_types 
[gw0] [  7%] FAILED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_feature_drift_with_mixed_data_types 
tests/unit/test_adaptation/test_optimizer.py::TestOptimizationConfig::test_config_initialization 
[gw0] [  7%] PASSED tests/unit/test_adaptation/test_optimizer.py::TestOptimizationConfig::test_config_initialization 
tests/unit/test_adaptation/test_optimizer.py::TestOptimizationConfig::test_config_validation 
[gw0] [  7%] PASSED tests/unit/test_adaptation/test_optimizer.py::TestOptimizationConfig::test_config_validation 
tests/unit/test_adaptation/test_optimizer.py::TestOptimizationConfig::test_config_customization 
[gw0] [  7%] PASSED tests/unit/test_adaptation/test_optimizer.py::TestOptimizationConfig::test_config_customization 
tests/unit/test_adaptation/test_optimizer.py::TestModelOptimizerInitialization::test_optimizer_initialization 
[gw0] [  7%] PASSED tests/unit/test_adaptation/test_optimizer.py::TestModelOptimizerInitialization::test_optimizer_initialization 
tests/unit/test_adaptation/test_optimizer.py::TestModelOptimizerInitialization::test_parameter_space_initialization 
[gw0] [  7%] ERROR tests/unit/test_adaptation/test_optimizer.py::TestModelOptimizerInitialization::test_parameter_space_initialization 
tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_bayesian_optimization 
[gw0] [  7%] ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_bayesian_optimization 
tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_grid_search_optimization 
[gw0] [  7%] ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_grid_search_optimization 
tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_random_search_optimization 
[gw0] [  8%] ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_random_search_optimization 
tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_performance_adaptive_optimization 
[gw0] [  8%] ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_performance_adaptive_optimization 

==================================== ERRORS ====================================
_ ERROR at setup of TestRetrainingStatusAndMetrics.test_all_retraining_status_retrieval _
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
__ ERROR at setup of TestRetrainingStatusAndMetrics.test_retrainer_statistics __
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
_ ERROR at setup of TestRetrainingStatusAndMetrics.test_performance_metrics_tracking _
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
_____ ERROR at setup of TestBackgroundTasks.test_retraining_processor_loop _____
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
_______ ERROR at setup of TestBackgroundTasks.test_trigger_checker_loop ________
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
__ ERROR at setup of TestBackgroundTasks.test_background_task_error_handling ___
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
_ ERROR at setup of TestNotificationIntegration.test_retraining_completion_notifications _
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
_ ERROR at setup of TestNotificationIntegration.test_retraining_failure_notifications _
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
_ ERROR at setup of TestErrorHandlingAndRecovery.test_model_training_failure_handling _
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
__ ERROR at setup of TestErrorHandlingAndRecovery.test_missing_model_handling __
[gw1] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_retrainer.py:69: in mock_model_registry
    return_value=TrainingResult(
E   TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
_ ERROR at setup of TestModelOptimizerInitialization.test_parameter_space_initialization _
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_optimizer.py:69: in mock_drift_detector
    drift_severity=DriftMetrics.DriftSeverity.MODERATE,
E   AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
___ ERROR at setup of TestOptimizationStrategies.test_bayesian_optimization ____
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_optimizer.py:69: in mock_drift_detector
    drift_severity=DriftMetrics.DriftSeverity.MODERATE,
E   AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
__ ERROR at setup of TestOptimizationStrategies.test_grid_search_optimization __
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_optimizer.py:69: in mock_drift_detector
    drift_severity=DriftMetrics.DriftSeverity.MODERATE,
E   AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
_ ERROR at setup of TestOptimizationStrategies.test_random_search_optimization _
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_optimizer.py:69: in mock_drift_detector
    drift_severity=DriftMetrics.DriftSeverity.MODERATE,
E   AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
_ ERROR at setup of TestOptimizationStrategies.test_performance_adaptive_optimization _
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_optimizer.py:69: in mock_drift_detector
    drift_severity=DriftMetrics.DriftSeverity.MODERATE,
E   AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
=================================== FAILURES ===================================
_____________ TestEnvironmentManager.test_configuration_validation _____________
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_environment_management.py:222: in test_configuration_validation
    assert any("Home Assistant URL is required" in error for error in errors)
E   assert False
E    +  where False = any(<generator object TestEnvironmentManager.test_configuration_validation.<locals>.<genexpr> at 0x7f40c7cc6400>)
_______ TestFeatureDriftDetector.test_numerical_feature_drift_detection ________
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_drift_detector.py:412: in test_numerical_feature_drift_detection
    assert len(drift_results) > 0
E   assert 0 > 0
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  src.adaptation.drift_detector:drift_detector.py:1179 Insufficient samples for drift detection in living_room: comparison=0, monitor=0
______ TestFeatureDriftDetector.test_categorical_feature_drift_detection _______
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_drift_detector.py:440: in test_categorical_feature_drift_detection
    assert feature_3_result is not None
E   assert None is not None
------------------------------ Captured log call -------------------------------
WARNING  src.adaptation.drift_detector:drift_detector.py:1179 Insufficient samples for drift detection in living_room: comparison=0, monitor=0
_____ TestDriftDetectionIntegration.test_combined_drift_detection_workflow _____
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_drift_detector.py:563: in test_combined_drift_detection_workflow
    assert drift_metrics.overall_drift_score > 0
E   AssertionError: assert 0.0 > 0
E    +  where 0.0 = DriftMetrics(room_id='test_room', detection_time=datetime.datetime(2025, 8, 13, 20, 37, 33, 482383), baseline_period=(datetime.datetime(2025, 7, 27, 20, 37, 33, 482383), datetime.datetime(2025, 8, 10, 20, 37, 33, 482383)), current_period=(datetime.datetime(2025, 8, 10, 20, 37, 33, 482383), datetime.datetime(2025, 8, 13, 20, 37, 33, 482383)), ks_statistic=0.0, ks_p_value=1.0, mw_statistic=0.0, mw_p_value=1.0, chi2_statistic=0.0, chi2_p_value=1.0, psi_score=inf, ph_statistic=0.0, ph_threshold=50.0, ph_drift_detected=False, drifting_features=['feature_2', 'feature_1'], feature_drift_scores={'feature_2': 1.0, 'feature_1': 1.0}, feature_importance_changes={}, accuracy_degradation=0.0, error_distribution_change=0.0, confidence_calibration_drift=0.0, occupancy_pattern_changes={}, temporal_pattern_drift=0.0, frequency_pattern_drift=0.0, overall_drift_score=0.0, drift_severity=<DriftSeverity.MINOR: 'minor'>, drift_types=[<DriftType.FEATURE_DRIFT: 'feature_drift'>], statistical_confidence=0.1, sample_size_baseline=0, sample_size_current=0, retraining_recommended=False, immediate_attention_required=False, affected_models=[]).overall_drift_score
------------------------------ Captured log call -------------------------------
WARNING  src.adaptation.drift_detector:drift_detector.py:976 Error getting occupancy patterns: 'async_generator' object does not support the asynchronous context manager protocol
WARNING  src.adaptation.drift_detector:drift_detector.py:976 Error getting occupancy patterns: 'async_generator' object does not support the asynchronous context manager protocol
WARNING  src.adaptation.drift_detector:drift_detector.py:1072 Error getting prediction errors: 'async_generator' object does not support the asynchronous context manager protocol
_____ TestDriftDetectionEdgeCases.test_feature_drift_with_mixed_data_types _____
[gw0] linux -- Python 3.11.13 /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
tests/unit/test_adaptation/test_drift_detector.py:855: in test_feature_drift_with_mixed_data_types
    assert len(drift_results) > 0
E   assert 0 > 0
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  src.adaptation.drift_detector:drift_detector.py:1179 Insufficient samples for drift detection in mixed_room: comparison=0, monitor=0
=============================== warnings summary ===============================
src/integration/api_server.py:79
src/integration/api_server.py:79
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:79: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("transition_type")

src/integration/api_server.py:86
src/integration/api_server.py:86
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:86: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("confidence")

../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_fields.py:161
../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_fields.py:161
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_fields.py:161: UserWarning: Field "model_info" has conflict with protected namespace "model_".
  
  You may be able to resolve this warning by setting `model_config['protected_namespaces'] = ()`.
    warnings.warn(

src/integration/api_server.py:117
src/integration/api_server.py:117
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:117: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("accuracy_rate", "confidence_calibration")

src/integration/api_server.py:124
src/integration/api_server.py:124
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:124: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("average_error_minutes")

src/integration/api_server.py:131
src/integration/api_server.py:131
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:131: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("total_predictions", "total_validations", "time_window_hours")

src/integration/api_server.py:138
src/integration/api_server.py:138
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:138: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("trend_direction")

src/integration/api_server.py:159
src/integration/api_server.py:159
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:159: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("room_id")

src/integration/api_server.py:171
src/integration/api_server.py:171
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:171: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("strategy")

src/integration/api_server.py:179
src/integration/api_server.py:179
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/api_server.py:179: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("reason")

src/integration/auth/auth_models.py:29
src/integration/auth/auth_models.py:29
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:29: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("permissions")

src/integration/auth/auth_models.py:49
src/integration/auth/auth_models.py:49
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:49: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("roles")

src/integration/auth/auth_models.py:89
src/integration/auth/auth_models.py:89
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:89: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("username")

src/integration/auth/auth_models.py:98
src/integration/auth/auth_models.py:98
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:98: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("password")

../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:291
../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:291
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:291: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:341
../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:341
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:341: UserWarning: Valid config keys have changed in V2:
  * 'schema_extra' has been renamed to 'json_schema_extra'
    warnings.warn(message, UserWarning)

src/integration/auth/auth_models.py:153
src/integration/auth/auth_models.py:153
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:153: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("refresh_token")

src/integration/auth/auth_models.py:208
src/integration/auth/auth_models.py:208
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:208: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("confirm_password")

src/integration/auth/auth_models.py:215
src/integration/auth/auth_models.py:215
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:215: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("new_password")

src/integration/auth/auth_models.py:246
src/integration/auth/auth_models.py:246
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:246: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("email")

src/integration/auth/auth_models.py:256
src/integration/auth/auth_models.py:256
  /home/runner/work/ha-ml-predictor/ha-ml-predictor/src/integration/auth/auth_models.py:256: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.8/migration/
    @validator("username")

tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_combined_drift_detection_workflow
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pandas/core/arraylike.py:399: RuntimeWarning: divide by zero encountered in log
    result = getattr(ufunc, method)(*inputs, **kwargs)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
- generated xml file: /home/runner/work/ha-ml-predictor/ha-ml-predictor/junit-unit.xml -

---------- coverage: platform linux, python 3.11.13-final-0 ----------
Name                                              Stmts   Miss  Cover   Missing
-------------------------------------------------------------------------------
src/__init__.py                                       0      0   100%
src/adaptation/__init__.py                            7      0   100%
src/adaptation/drift_detector.py                    505    176    65%   375-377, 422, 429, 434-435, 486, 514-515, 531, 554-556, 659-662, 685, 691, 703-705, 746-748, 778-780, 802-824, 838-867, 898, 910-912, 922-931, 940-973, 985-1010, 1018-1035, 1044-1069, 1119-1120, 1170-1172, 1186-1205, 1215-1236, 1245-1271, 1286-1338, 1351-1383, 1387-1393, 1417-1419, 1431
src/adaptation/monitoring_enhanced_tracking.py       95     95     0%   6-283
src/adaptation/optimizer.py                         356    246    31%   27-30, 94, 232-321, 336-338, 342-359, 389-433, 439-447, 453-463, 476-529, 535-541, 547-564, 579-638, 644-700, 715-764, 784-826, 839, 852-857, 970
src/adaptation/retrainer.py                         631    510    19%   122-125, 129, 133, 232-242, 282-320, 326-343, 347-359, 380-502, 527-566, 580-645, 657-693, 697-759, 765-801, 809-830, 834-845, 849-887, 891-914, 918-961, 965-979, 985-1029, 1035-1080, 1086-1095, 1106-1224, 1235-1236, 1242-1252, 1263-1264, 1270-1287, 1296-1346, 1357-1412, 1418-1452, 1458-1479, 1485-1504, 1510-1566, 1570-1588, 1592-1610, 1617
src/adaptation/tracker.py                           616    500    19%   109-144, 154, 162, 264, 269-284, 288-292, 296-299, 305-316, 320, 388-428, 436-454, 458-475, 492-533, 550-585, 598-608, 623-646, 667-712, 718-720, 726-728, 732-766, 772-798, 802-828, 832-874, 883-960, 964-975, 979-1040, 1050-1093, 1103-1136, 1144-1153, 1159-1184, 1190-1227, 1231-1246, 1252-1411, 1415-1423, 1427-1463, 1467-1539, 1545-1556, 1564
src/adaptation/tracking_manager.py                  816    676    17%   22-26, 59-64, 208-269, 273-358, 362-393, 397-441, 453-572, 594-621, 626-704, 712-722, 728-742, 746-756, 762-768, 774-780, 795-831, 843-878, 884-907, 911-962, 968-976, 980-1002, 1006-1029, 1033-1055, 1059-1120, 1124-1140, 1146-1261, 1265-1305, 1313-1350, 1354-1401, 1406-1412, 1433-1464, 1470-1478, 1482-1490, 1503-1510, 1520-1527, 1531-1540, 1549-1565, 1569-1575, 1579-1598, 1602-1677, 1681-1730, 1747-1773, 1788-1824, 1855-1903, 1919-1989, 2000-2036, 2041-2048, 2052-2118, 2124-2136, 2142-2154, 2158-2210, 2215-2222, 2226-2268, 2275
src/adaptation/validator.py                         584    464    21%   106-142, 146-154, 158-165, 169, 256-258, 263-265, 270-275, 284, 288, 356-384, 391-404, 408-420, 439-482, 503-564, 587-616, 622, 628, 645-673, 685-724, 745-780, 784-815, 827-871, 877-905, 910-947, 958-977, 986-1005, 1011-1125, 1129-1134, 1138-1148, 1152-1160, 1164-1175, 1179-1205, 1209-1242, 1246-1368, 1378-1488, 1499-1553, 1559-1566, 1574
src/core/__init__.py                                  0      0   100%
src/core/backup_manager.py                          351    243    31%   54, 83, 104-109, 116-123, 161-162, 189-194, 198-292, 302-309, 324-377, 381-421, 425-427, 431-438, 453-502, 506-508, 534-594, 598-635, 644-654, 661-669, 673, 677, 681-724
src/core/config.py                                  270     74    73%   120, 166, 171, 216, 238-254, 258-264, 283-286, 290-293, 302, 307-356, 372, 453-456, 463-475
src/core/config_validator.py                        426    231    46%   58-76, 95, 100, 116, 121, 132-133, 137-181, 196-197, 218, 223, 231-295, 310, 317, 319, 327-328, 335, 337, 343, 352-414, 426-427, 469-501, 507-510, 515-516, 531, 533, 559, 569, 571-573, 586, 588, 591-596, 642-643, 647-665, 670-674, 678, 697-746
src/core/constants.py                                47      0   100%
src/core/environment.py                             274     96    65%   155-157, 165, 172-220, 350, 354, 358, 382, 402, 407, 412, 429, 435-440, 447-448, 453-455, 491, 493, 499-518, 522-528, 532-570, 578-599
src/core/exceptions.py                              271    156    42%   43-48, 52-64, 74-78, 85-88, 107-110, 123-124, 146-147, 160-161, 183-186, 203-209, 221-222, 244-246, 257, 269-270, 286-287, 305-308, 339-344, 363-368, 381-386, 404-416, 434-438, 470-477, 496-505, 522-527, 544-547, 575-580, 599-600, 613-614, 638-648, 666-677, 704-705, 727-734, 746-752, 773-774, 786-789, 804-807, 819-822, 834-835, 851-852, 867-868, 890-901, 917, 929, 941, 953-954, 967
src/data/__init__.py                                  0      0   100%
src/data/ingestion/__init__.py                        0      0   100%
src/data/ingestion/bulk_importer.py                 419    419     0%   8-1006
src/data/ingestion/event_processor.py               558    482    14%   55-59, 66, 93, 105-189, 201-203, 218-240, 251-292, 296-309, 315-323, 329-335, 339-343, 347-373, 377-402, 409-433, 441-472, 476-503, 507-534, 544-567, 583-598, 612-635, 651-665, 685-712, 716-740, 745-764, 784-803, 815-864, 879-897, 902-919, 923-931, 941-975, 983-995, 1016-1081, 1087-1091, 1095, 1099, 1121-1227, 1243-1265
src/data/ingestion/ha_client.py                     369    314    15%   53, 64-67, 71-97, 113-132, 136-137, 141, 145-171, 175-177, 181-193, 197-210, 214-234, 239-256, 262-278, 282-297, 301-347, 359-399, 403-413, 417-424, 428-453, 462-489, 493, 497-498, 502-543, 562-614, 635-676, 688-698, 704, 723-754, 759
src/data/storage/__init__.py                          3      0   100%
src/data/storage/database.py                        372    329    12%   54-77, 81-103, 112-140, 144-187, 197-200, 210-227, 240-299, 325-368, 394-436, 460-513, 517-542, 551-609, 618-744, 748-757, 761, 766-780, 784, 789, 805-809, 819-821, 828-830, 844-860, 873-889, 899-906, 916-926
src/data/storage/models.py                          410    232    43%   147-162, 173-190, 201-227, 231-233, 255-320, 337-394, 405-410, 427-482, 553-560, 567-579, 583-585, 607-697, 718-741, 844-858, 869-893, 914-919, 923-928, 936-960, 983-1035, 1042-1051, 1056-1085, 1092-1106, 1121-1134, 1255-1274, 1278-1283, 1356-1367, 1384-1395, 1404-1424, 1429-1443, 1447-1450, 1466-1523, 1530-1555, 1560
src/data/validation/__init__.py                       0      0   100%
src/features/__init__.py                              0      0   100%
src/features/contextual.py                          293    267     9%   44-60, 90-138, 144-272, 278-352, 361-433, 437-463, 469-516, 525-596, 602-624, 628-641, 647-688, 692, 740, 744
src/features/engineering.py                         287    250    13%   49-78, 106-189, 212-262, 274-333, 345-392, 403-413, 438-466, 483-497, 502-514, 518, 522, 536-538, 547-578, 584-611, 624-670, 679-696, 700-747, 755-761, 765-771, 775-782, 786-793, 797-798
src/features/sequential.py                          332    306     8%   54-56, 80-123, 129-197, 201-282, 288-341, 347-483, 489-669, 673-722, 728-771, 777-780, 793, 841, 845
src/features/store.py                               205    155    24%   40-43, 48-50, 54-55, 68-71, 81-82, 105-119, 141-157, 161-163, 167-170, 204-215, 226-232, 257-323, 344-375, 400-442, 452-469, 475-521, 533, 547, 553-554, 558-561, 569-570, 574-582, 586-619, 623-624, 629
src/features/temporal.py                            287    261     9%   43-44, 66-104, 110-166, 172-245, 256-350, 355-388, 394-504, 510-553, 559-604, 608, 660, 666-703, 707, 724-731
src/integration/__init__.py                          34     18    47%   85-92, 215-229, 248-258, 263
src/integration/api_server.py                       597    421    29%   82-84, 89-91, 120-122, 127-129, 134-136, 141-146, 162-169, 174-177, 182-184, 219-238, 254-274, 280, 285-286, 293-304, 309-318, 327-346, 351-413, 468-479, 492-509, 523-535, 554-590, 615-624, 633, 644-815, 821-860, 884-906, 912-920, 926-938, 944-965, 971-991, 997-1012, 1018-1031, 1037-1057, 1063-1071, 1077-1099, 1107-1127, 1133-1146, 1152-1165, 1175-1214, 1222-1239, 1250-1275, 1286-1314, 1322-1336, 1344-1378, 1392-1395, 1399-1417, 1421-1426, 1430, 1445-1448
src/integration/auth/__init__.py                      6      0   100%
src/integration/auth/auth_models.py                 146     57    61%   32-47, 52-58, 62, 66, 70, 92-96, 101-116, 156-164, 211-213, 218-233, 249-254, 259-263, 285-287, 291
src/integration/auth/dependencies.py                 93     71    24%   32-41, 65-102, 125-128, 151-164, 187-198, 218-224, 250-280, 298-317, 330-345
src/integration/auth/endpoints.py                   148    112    24%   84, 89, 94, 109-192, 207-227, 244-263, 276, 288-321, 337-366, 382-397, 409-455, 468-496
src/integration/auth/exceptions.py                   65     43    34%   22-26, 44-50, 67-71, 83-87, 99-103, 115-117, 131-139, 152, 165-171, 188-194
src/integration/auth/jwt_manager.py                 181    151    17%   28-31, 35-38, 42-50, 54-60, 81-95, 117-150, 162-183, 199-245, 261-279, 291-308, 320-340, 353-367, 385-416, 420-425, 429-436, 440-448, 460-480
src/integration/auth/middleware.py                  132    106    20%   34-35, 39-92, 105-128, 138-224, 247-278, 283-293, 298-306, 311-321, 333-355, 367-368, 372-421
src/integration/dashboard.py                        666    556    17%   34-46, 156, 188-193, 212-236, 240-250, 265-285, 297-320, 324-330, 368-398, 406-426, 432-617, 621-654, 658-690, 694-730, 734-816, 825-923, 932-995, 1005-1070, 1079-1177, 1189-1271, 1283-1319, 1329-1368, 1372-1392, 1400-1416, 1425-1458, 1462-1478, 1482-1507, 1511-1552, 1556-1566, 1570-1578, 1590, 1611-1623, 1637-1643
src/integration/discovery_publisher.py              392    263    33%   202-262, 271-326, 341-379, 388-431, 443-469, 484-487, 491, 536-584, 599-661, 680-709, 723-747, 760-777, 791-847, 859, 876, 889, 903, 915, 928, 942, 957, 970, 983, 996, 1008, 1024-1159, 1172
src/integration/enhanced_integration_manager.py     383    383     0%   17-922
src/integration/enhanced_mqtt_manager.py            224    180    20%   85-129, 136-157, 163-181, 203-235, 258-305, 309, 315, 319, 323, 327-366, 370-393, 399-401, 405-406, 414-421, 427-439, 445-482, 486-529, 535-551, 555-576, 580-611, 618
src/integration/ha_entity_definitions.py            514    514     0%   18-1701
src/integration/ha_tracking_bridge.py               249    249     0%   16-605
src/integration/monitoring_api.py                   131    131     0%   6-285
src/integration/mqtt_integration_manager.py         310    264    15%   70-96, 100-167, 171-190, 194-215, 237-267, 290-317, 326-349, 353-450, 454, 462-464, 468-470, 476-503, 507-522, 526-543, 547, 561-585, 600-650, 662-676, 687-703, 719-733, 740
src/integration/mqtt_publisher.py                   318    268    16%   83-115, 119-163, 167-189, 193-226, 247-339, 366, 370-375, 379, 404-453, 457-463, 467-492, 496-519, 523-562, 568-597, 601-628, 632-641, 645-660, 664-678, 685
src/integration/prediction_publisher.py             163    106    35%   116-131, 150-241, 270-360, 383-395, 399, 418-455, 459-477, 481-486, 496-501
src/integration/realtime_api_endpoints.py           292    230    21%   50, 55-60, 97-118, 128-231, 241-257, 270-294, 308-354, 367-405, 418-431, 444-486, 499-531, 550-613, 633-648, 652-656, 660-676, 680-695, 699, 703, 707, 711-722, 739-777
src/integration/realtime_publisher.py               480    385    20%   65, 85-86, 101, 113, 124-126, 132-147, 151-157, 161-164, 168-171, 177-199, 203-224, 228, 258-260, 264-281, 285-291, 295-298, 304-326, 330-351, 355, 406-438, 445-458, 462-478, 499-604, 618-659, 665-703, 710-743, 756-760, 764-766, 771-776, 798-806, 835-897, 901-919, 923-958, 962-979, 983-995, 1002, 1019-1027, 1033-1086, 1095-1110
src/integration/tracking_integration.py             186    145    22%   76-90, 94-132, 136-153, 157-159, 163-165, 169-202, 206-207, 211-212, 218-232, 236-250, 254-286, 290-350, 354-375, 396-411, 434-457, 464
src/integration/websocket_api.py                    629    629     0%   21-1441
src/main_system.py                                   78     78     0%   9-157
src/models/__init__.py                                0      0   100%
src/models/base/__init__.py                           6      0   100%
src/models/base/gp_predictor.py                     352    316    10%   33-41, 73-109, 121-234, 255-417, 438-531, 542-585, 595-614, 627-653, 668-703, 717-742, 763-779, 791-811, 815-824, 828-840, 844-861, 883-1031
src/models/base/hmm_predictor.py                    249    221    11%   42-70, 91-246, 267-347, 358-409, 413-425, 436-491, 507-514, 518-539, 552-576, 583-594, 598-610, 619-632, 642-656, 660
src/models/base/lstm_predictor.py                   191    169    12%   43-80, 101-258, 277-366, 377-421, 436-470, 485-519, 523-543
src/models/base/predictor.py                        160    104    35%   41-68, 87, 122-138, 163, 186, 196, 216-222, 234-257, 269-294, 298, 322, 334-346, 350, 362-381, 385-389, 393-404, 408-410, 414
src/models/base/xgboost_predictor.py                183    159    13%   41-69, 90-246, 265-333, 342-345, 354-355, 367-384, 403-437, 450-487, 499-523, 532-535, 539-542
src/models/ensemble.py                              354    319    10%   49-90, 113-230, 249-295, 304-329, 352-470, 476-554, 563-597, 607-637, 641-656, 667-694, 699-726, 747-825, 834-893, 897-909, 913
src/models/training_config.py                       236    151    36%   55-69, 85-102, 171-184, 197-209, 214-321, 346-370, 377-401, 415-462, 466-474, 478-482, 486, 492-499, 505-512, 518-519, 523-535, 539-587, 591-612, 616-629, 640-643, 650-651
src/models/training_integration.py                  369    369     0%   9-841
src/models/training_pipeline.py                     693    543    22%   170-191, 219, 258-289, 308-368, 387-399, 422-449, 472-635, 641-675, 681-710, 716-831, 851, 861-912, 925-958, 980-1025, 1042-1071, 1088-1122, 1139-1165, 1180-1249, 1259-1319, 1328-1389, 1393-1401, 1411-1469, 1473-1474, 1484-1524, 1530-1543, 1549-1573, 1577-1588, 1592-1624, 1630, 1634, 1638, 1642, 1646, 1652-1688, 1694-1712, 1721-1760, 1764-1770, 1776-1817, 1821-1826
src/utils/__init__.py                                 0      0   100%
src/utils/alerts.py                                 252    159    37%   92-93, 97-111, 115-118, 125-126, 130-147, 151-161, 167-205, 209-215, 222-223, 227-264, 271-273, 277-305, 311, 318-320, 326, 330-372, 379-401, 405-473, 477-478, 482-484, 496-545, 549-562, 575-584, 595-596, 602-620, 633-639, 650, 675-677
src/utils/health_monitor.py                         534    427    20%   86, 90, 94, 131-145, 149, 176-205, 209, 224-225, 229, 233-253, 257-271, 275-334, 338-352, 358-457, 461-465, 469-534, 546-583, 595-658, 670-767, 779-819, 831-866, 878-948, 960-1029, 1041-1112, 1131-1137, 1142-1177, 1190-1240, 1244, 1273, 1279-1282, 1288-1292, 1300, 1304-1306, 1331-1333
src/utils/incident_response.py                      392    289    26%   70-77, 81-84, 88-89, 129-135, 139-143, 149-155, 166-178, 188-196, 200, 238-270, 276-318, 333-337, 349-363, 367-381, 385-403, 407-437, 441-520, 524-624, 633-649, 654-662, 670-677, 688-712, 724-740, 744-785, 791-803, 807-821, 825-847, 851-867, 873, 877, 881-882, 886-898, 916-926, 930-945, 955-957
src/utils/logger.py                                 124     76    39%   25-26, 30-86, 93, 104, 124, 139, 153, 168, 178-192, 204-210, 216-221, 227-232, 239, 249, 265, 285, 301, 317-321, 325-363, 367, 371, 375, 379, 384-415, 433-435, 440, 445, 450, 455
src/utils/metrics.py                                296    242    18%   29-117, 124-126, 132-317, 325-340, 353-367, 381-391, 399-411, 423, 431, 439, 447, 453, 459, 465-469, 475-496, 500, 506, 510, 514-515, 521-526, 533-537, 541-560, 564-566, 570-574, 578, 588-590, 595, 600, 606-642, 655-664, 668, 672, 681-712, 721-728, 732-740, 750-752, 761-770, 783-799, 812-819
src/utils/monitoring.py                             273    273     0%   6-695
src/utils/monitoring_integration.py                 111    111     0%   6-430
-------------------------------------------------------------------------------
TOTAL                                             19976  15770    21%
Coverage HTML written to dir htmlcov-unit
Coverage XML written to file coverage-unit.xml

- Generated html report: file:///home/runner/work/ha-ml-predictor/ha-ml-predictor/report-unit.html -
=========================== short test summary info ============================
FAILED tests/unit/test_environment_management.py::TestEnvironmentManager::test_configuration_validation - assert False
 +  where False = any(<generator object TestEnvironmentManager.test_configuration_validation.<locals>.<genexpr> at 0x7f40c7cc6400>)
FAILED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_numerical_feature_drift_detection - assert 0 > 0
 +  where 0 = len([])
FAILED tests/unit/test_adaptation/test_drift_detector.py::TestFeatureDriftDetector::test_categorical_feature_drift_detection - assert None is not None
FAILED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionIntegration::test_combined_drift_detection_workflow - AssertionError: assert 0.0 > 0
 +  where 0.0 = DriftMetrics(room_id='test_room', detection_time=datetime.datetime(2025, 8, 13, 20, 37, 33, 482383), baseline_period=(datetime.datetime(2025, 7, 27, 20, 37, 33, 482383), datetime.datetime(2025, 8, 10, 20, 37, 33, 482383)), current_period=(datetime.datetime(2025, 8, 10, 20, 37, 33, 482383), datetime.datetime(2025, 8, 13, 20, 37, 33, 482383)), ks_statistic=0.0, ks_p_value=1.0, mw_statistic=0.0, mw_p_value=1.0, chi2_statistic=0.0, chi2_p_value=1.0, psi_score=inf, ph_statistic=0.0, ph_threshold=50.0, ph_drift_detected=False, drifting_features=['feature_2', 'feature_1'], feature_drift_scores={'feature_2': 1.0, 'feature_1': 1.0}, feature_importance_changes={}, accuracy_degradation=0.0, error_distribution_change=0.0, confidence_calibration_drift=0.0, occupancy_pattern_changes={}, temporal_pattern_drift=0.0, frequency_pattern_drift=0.0, overall_drift_score=0.0, drift_severity=<DriftSeverity.MINOR: 'minor'>, drift_types=[<DriftType.FEATURE_DRIFT: 'feature_drift'>], statistical_confidence=0.1, sample_size_baseline=0, sample_size_current=0, retraining_recommended=False, immediate_attention_required=False, affected_models=[]).overall_drift_score
FAILED tests/unit/test_adaptation/test_drift_detector.py::TestDriftDetectionEdgeCases::test_feature_drift_with_mixed_data_types - assert 0 > 0
 +  where 0 = len([])
ERROR tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_all_retraining_status_retrieval - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_retrainer_statistics - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestRetrainingStatusAndMetrics::test_performance_metrics_tracking - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_retraining_processor_loop - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_trigger_checker_loop - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestBackgroundTasks::test_background_task_error_handling - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestNotificationIntegration::test_retraining_completion_notifications - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestNotificationIntegration::test_retraining_failure_notifications - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestErrorHandlingAndRecovery::test_model_training_failure_handling - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_retrainer.py::TestErrorHandlingAndRecovery::test_missing_model_handling - TypeError: TrainingResult.__init__() got an unexpected keyword argument 'model_metrics'
ERROR tests/unit/test_adaptation/test_optimizer.py::TestModelOptimizerInitialization::test_parameter_space_initialization - AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_bayesian_optimization - AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_grid_search_optimization - AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_random_search_optimization - AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
ERROR tests/unit/test_adaptation/test_optimizer.py::TestOptimizationStrategies::test_performance_adaptive_optimization - AttributeError: type object 'DriftMetrics' has no attribute 'DriftSeverity'
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 20 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!! xdist.dsession.Interrupted: stopping after 10 failures !!!!!!!!!!!!
============ 5 failed, 42 passed, 43 warnings, 15 errors in 20.44s =============
Error: Process completed with exit code 2.